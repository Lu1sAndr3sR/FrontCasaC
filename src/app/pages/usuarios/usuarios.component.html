<div class="topbar">
  <img src="assets/logoC.png" class="logo" (click)="goDashboard()">
</div>

<div class="usuarios-wrapper">

  <img src="assets/volver.png" class="back-btn-img" (click)="goDashboard()">

  <div class="header-line">
    <h2 class="titulo">Gestión de Usuarios</h2>
    <div class="buscador-container">
      <input type="text" placeholder="Buscar..." (input)="buscarUsuario($any($event.target).value)">
      <button class="btn-lupa"><img src="assets/buscar.png"></button>
    </div>
  </div>

  <div class="lista-usuarios">
    <div class="usuario-item" *ngFor="let u of usuarios">
      
      <div class="icono-usuario">
        <svg width="40" height="40" fill="#0A2647" *ngIf="u.rol === 'ADMINISTRADOR'">
             <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
        </svg>
        <svg width="40" height="40" fill="#0A2647" *ngIf="u.rol !== 'ADMINISTRADOR'">
            <circle cx="20" cy="12" r="8"></circle>
            <rect x="6" y="22" width="28" height="14" rx="7"></rect>
        </svg>
      </div>

      <div class="datos-usuario">
        <p class="nombre">{{ u.nombre }}</p>
        <p class="rol">{{ u.rol }}</p>
      </div>

      <div class="acciones">
        <ng-container *ngIf="soyAdmin; else soloLectura">
            
            <button class="btn-edit" (click)="abrirEditar(u)">
              <img src="assets/Editar.png" width="28">
            </button>
    
            <button class="btn-delete" 
                    (click)="abrirEliminar(u)" 
                    *ngIf="u.usuario !== usuarioActual">
              <img src="assets/Eliminar.png" width="28">
            </button>

            <span *ngIf="u.usuario === usuarioActual" 
                  style="font-size: 0.8rem; color: #888; font-weight: bold;">
                  (Tú)
            </span>

        </ng-container>

        <ng-template #soloLectura>
            <span style="font-size: 0.8rem; color: #888;">Solo Lectura</span>
        </ng-template>
      </div>
    </div>
  </div>

  <img src="assets/AddUser.png" 
       class="btn-agregar-img" 
       (click)="abrirAgregar()"
       *ngIf="soyAdmin">
</div>

<div class="modal-backdrop" *ngIf="modalAgregar">
  <div class="modal-box">
    <h3>Nuevo Usuario</h3>
    <div class="form-group">
      <label>Nombre Completo:</label>
      <input type="text" [(ngModel)]="nuevoUsuario.nombre" placeholder="Ej. Juan Pérez">
    </div>
    <div class="form-group">
      <label>Usuario (Login):</label>
      <input type="text" [(ngModel)]="nuevoUsuario.usuario" placeholder="Ej. juanperez">
    </div>
    <div class="form-group">
      <label>Contraseña:</label>
      <input type="password" [(ngModel)]="nuevoUsuario.contrasena" placeholder="********">
    </div>
    <div class="form-group">
      <label>Rol:</label>
      <select [(ngModel)]="nuevoUsuario.rol">
        <option value="EMPLEADO">EMPLEADO</option>
        <option value="ADMINISTRADOR">ADMINISTRADOR</option>
      </select>
    </div>
    <div class="modal-botones">
      <button class="btn-save" (click)="guardarNuevo()">Guardar Usuario</button>
      <button class="btn-cancel" (click)="cerrarModal()">Cancelar</button>
    </div>
  </div>
</div>

<div class="modal-backdrop" *ngIf="modalEditar">
  <div class="modal-box">
    <h3>Editar Usuario</h3>
    <div class="form-group">
        <label>Nombre:</label>
        <input [(ngModel)]="usuarioEditando.nombre">
    </div>
    <div class="form-group">
        <label>Usuario (Login):</label>
        <input [(ngModel)]="usuarioEditando.usuario">
    </div>
    <div class="form-group">
        <label>Nueva Contraseña (Opcional):</label>
        <input type="password" [(ngModel)]="usuarioEditando.contrasena" placeholder="Dejar vacío para mantener">
    </div>
    <div class="form-group">
        <label>Rol:</label>
        <select [(ngModel)]="usuarioEditando.rol">
            <option value="EMPLEADO">EMPLEADO</option>
            <option value="ADMINISTRADOR">ADMINISTRADOR</option>
        </select>
    </div>
    <div class="modal-botones">
      <button class="btn-save" (click)="guardarEdicion()">Guardar</button>
      <button class="btn-cancel" (click)="cerrarModal()">Cancelar</button>
    </div>
  </div>
</div>

<div class="modal-backdrop" *ngIf="modalEliminar">
  <div class="modal-box">
    <h3>¿Eliminar usuario?</h3>
    <p>Se eliminará a: <strong>{{ usuarioEliminando?.nombre }}</strong></p>
    <div class="modal-botones">
      <button class="btn-cancel" (click)="confirmarEliminar()">Eliminar</button>
      <button class="btn-save" style="background:#888;" (click)="cerrarModal()">Cancelar</button>
    </div>
  </div>
</div>