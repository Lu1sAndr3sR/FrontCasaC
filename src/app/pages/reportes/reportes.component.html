<div class="window">

  <div class="topbar">
    <img src="assets/logoC.png" class="logo" (click)="goDashboard()">
    <div class="topbar-links">
      <button (click)="goCaja()">Caja</button>
      <button (click)="goUsuarios()">Usuarios</button>
      <button (click)="goInventario()">Inventario</button>
      <button (click)="goNotificaciones()">Notificaciones</button>
    </div>
  </div>

  <div class="reportes-container">

    <div class="reportes-header">
      <h2>Reportes y Estad칤sticas</h2>

      <div class="filtros-fecha">
        <label>Del:</label>
        <input type="date" [(ngModel)]="fechaInicio" (change)="cargarDatos()">
        <label>Al:</label>
        <input type="date" [(ngModel)]="fechaFin" (change)="cargarDatos()">
      </div>
    </div>

    <div class="tabs-container">
      <button class="tab-btn" [class.active]="tabActiva === 'ventas'" (click)="cambiarTab('ventas')">游눯 Ventas</button>
      <button class="tab-btn" [class.active]="tabActiva === 'productos'" (click)="cambiarTab('productos')">游닍 Ranking</button>
      <button class="tab-btn" [class.active]="tabActiva === 'caja'" (click)="cambiarTab('caja')">游놅 Auditor칤a</button>

      <button class="tab-btn" [class.active]="tabActiva === 'graficas'" (click)="cambiarTab('graficas')">游늵 Gr치ficas</button>
    </div>

    <div class="tab-content">

      <div *ngIf="tabActiva === 'ventas'">
        <div class="cards-grid">
          <div class="card">
            <h3>Total Ingresos</h3>
            <p class="cantidad" style="color: #4cc9f0;">${{ resumenVentas.totalDinero | number:'1.2-2' }}</p>
          </div>
          <div class="card">
            <h3>Ventas Totales</h3>
            <p class="cantidad">{{ resumenVentas.conteoVentas }}</p>
          </div>
        </div>

        <table class="report-table">
          <thead>
            <tr>
              <th>Folio</th>
              <th>Hora</th>
              <th>Cajero</th>
              <th>Tipo</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let v of listaVentas">
              <td>#{{ v.folio }}</td>
              <td>{{ v.fecha | date:'shortTime' }}</td>
              <td>{{ v.nombre_cajero }}</td>
              <td>{{ v.tipo_venta }}</td>
              <td class="money">${{ v.total | number:'1.2-2' }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div *ngIf="tabActiva === 'productos'">
        <h3 class="subtitulo">Productos M치s Vendidos</h3>
        <table class="report-table">
          <thead>
            <tr>
              <th>C칩digo</th>
              <th>Producto</th>
              <th>Stock Actual</th>
              <th>Cant. Vendida</th>
              <th>$$ Generado</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let p of listaProductos">
              <td>{{ p.codigo_barras }}</td>
              <td>{{ p.nombre_producto }}</td>
              <td>{{ p.stock_actual }}</td>
              <td style="color: #4cc9f0; font-weight: bold;">{{ p.cantidad_vendida }}</td>
              <td class="money">${{ p.dinero_generado | number:'1.2-2' }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div *ngIf="tabActiva === 'caja'">
        <h3 class="subtitulo">Cortes de Caja</h3>
        <table class="report-table">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Abri칩</th>
              <th>Cerr칩</th>
              <th>Inicial</th>
              <th>Final</th>
              <th>Diferencia</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let c of listaCortes">
              <td>{{ c.fecha_apertura | date:'dd/MM HH:mm' }}</td>
              <td>{{ c.abrio }}</td>
              <td>{{ c.cerro || '---' }}</td>
              <td>${{ c.monto_inicial }}</td>
              <td>${{ c.monto_final || 0 }}</td>
              <td [style.color]="c.diferencia_calculada < 0 ? '#ff5f5f' : '#4cd96f'">
                {{ c.diferencia_calculada | currency }}
              </td>
            </tr>
          </tbody>
        </table>

        <h3 class="subtitulo" style="margin-top: 30px;">Movimientos y Retiros</h3>
        <table class="report-table">
          <thead>
            <tr>
              <th>Hora</th>
              <th>Usuario</th>
              <th>Tipo</th>
              <th>Monto</th>
              <th>Concepto</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let m of listaMovimientosCaja">
              <td>{{ m.fecha | date:'shortTime' }}</td>
              <td>{{ m.usuario }}</td>
              <td>{{ m.tipo_movimiento }}</td>
              <td class="money">${{ m.monto }}</td>
              <td>{{ m.concepto }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div *ngIf="tabActiva === 'movimientos'">
        <h3 class="subtitulo">Entradas y Salidas de Mercanc칤a</h3>
        <table class="report-table">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Producto</th>
              <th>Movimiento</th>
              <th>Cantidad</th>
              <th>Usuario</th>
              <th>Motivo</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let m of listaBitacoraInv">
              <td>{{ m.fecha | date:'dd/MM HH:mm' }}</td>
              <td>{{ m.nombre_producto }}</td>
              <td>
                <span [style.color]="m.tipo_movimiento === 'ENTRADA' ? '#4cd96f' : '#ff5f5f'">
                  {{ m.tipo_movimiento }}
                </span>
              </td>
              <td style="font-size:16px;">{{ m.cantidad }}</td>
              <td>{{ m.nombre_usuario }}</td>
              <td style="color:#aaa; font-style:italic;">{{ m.observaciones }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div *ngIf="tabActiva === 'graficas'">
        <div class="graficas-grid">
          
          <div class="grafica-card">
            <h3>游끥 Top 5 M치s Vendidos</h3>
            <div class="canvas-container">
              <canvas id="chartBarras"></canvas>
            </div>
          </div>

          <div class="grafica-card">
            <h3>游늳 Tendencia de Ventas (Por D칤a)</h3>
            <div class="canvas-container">
              <canvas id="chartLinea"></canvas>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>