<div class="inventory-page">

  <!-- TOP BAR -->
  <div class="top-bar">
    <div class="top-left">
      <img src="assets/logoC.png" alt="logo" class="logo" onerror="this.style.display='none'">
    </div>

    <div class="top-center">
      <div class="menu-inline">
        <span class="menu-item" (click)="goTo('/dashboard')">Home</span>
        <span class="menu-item" (click)="goTo('/caja')">Nueva Venta</span>
        <span class="menu-item active">Inventario</span>
        <span class="menu-item">Reportes</span>
      </div>

      <div class="search-row">
        <div class="search-box">
          <i class="bi bi-search"></i>
          <input type="text" 
                 placeholder="Buscar por nombre o c√≥digo..." 
                 (input)="buscar($event)">
          <div class="search-tools">Total: {{ filtered.length }}</div>
        </div>
      </div>
    </div>

    <div class="top-right">
      <div class="cajero-label">CAJERO:</div>
      <div class="datetime">{{ fechaActual }} &nbsp; - &nbsp; {{ horaActual }}</div>
    </div>
  </div>

  <!-- MAIN AREA -->
  <div class="main-area">

    <div class="inventory-header">
      <div class="inventory-title">
        <div class="ico-red"><span>‚åÅ</span></div>
        <h1>Inventario</h1>
      </div>

      <div class="filters">
        <button class="btn-filter" [class.active]="selectedFilter==='todos'" (click)="selectFilter('todos')">Todos</button>
        <button class="btn-filter" [class.active]="selectedFilter==='bajo'" (click)="selectFilter('bajo')">Bajo Stock</button>
        <button class="btn-filter" [class.active]="selectedFilter==='categoria'" (click)="openCategorias()">Categor√≠as</button>
      </div>
    </div>

    <!-- TABLE -->
    <div class="table-card">
      <div class="table-head">
        <div>Miniatura</div>
        <div>Nombre de Producto</div>
        <div>C√≥digo Barras</div>
        <div>Precio</div>
        <div>Stock</div>
        <div>Acciones</div>
      </div>

      <div class="table-body">
        @for (p of filtered; track p.producto_id) {
          <div class="row">
            <div class="cell thumb">
              <img src="assets/productos/default.png" alt="mini" onerror="this.src='https://via.placeholder.com/50'">
            </div>
            
            <div class="cell name">
              <div class="small">{{ p.descripcion }}</div>
              <div class="big">{{ p.nombre }}</div>
            </div>
            
            <div class="cell sku">{{ p.codigo_barras }}</div>
            
            <div class="cell price">${{ p.precio_menudeo }}</div>
            
            <div class="cell stock" [class.low]="p.stock_actual <= p.stock_minimo">
              {{ p.stock_actual }}
            </div>
            
            <div class="cell actions">
              <button class="link" (click)="editar(p)">Editar</button>
              <button class="icon-del" (click)="eliminar(p)">üóëÔ∏è</button>
            </div>
          </div>
        } @empty {
          <div class="row" style="justify-content: center; padding: 20px; color: #666;">
            No se encontraron productos coinciden con tu b√∫squeda.
          </div>
        }
      </div>
    </div>

    <!-- BOT√ìN FLOTANTE PARA AGREGAR PRODUCTO -->
    <button class="fab" title="Agregar Producto" (click)="abrirModalAgregar()">+</button>

  </div> <!-- FIN MAIN AREA -->

  <!-- MODAL CATEGOR√çAS -->
  <div class="modal-backdrop" *ngIf="modalCategorias">
    <div class="modal">
      <h3>Seleccionar Categor√≠a</h3>
      <ul>
        <li *ngFor="let c of categorias" (click)="filterByCategory(c)">{{ c }}</li>
      </ul>
      <div class="modal-actions">
        <button class="btn close" (click)="closeCategorias()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- MODAL AGREGAR PRODUCTO -->
  <div class="modal-backdrop" *ngIf="modalAgregar">
    <div class="modal modal-agregar">
      <h3>Agregar Producto</h3>

      <label>Nombre del producto</label>
      <input type="text" [(ngModel)]="nuevo.nombre">

      <label>C√≥digo de barras</label>
      <input type="text" [(ngModel)]="nuevo.barras">

      <label>C√≥digo abreviado (opcional)</label>
      <input type="text" [(ngModel)]="nuevo.abreviado">

      <label>Precio de compra</label>
      <input type="number" [(ngModel)]="nuevo.precioCompra">

      <label>Precio de venta</label>
      <input type="number" [(ngModel)]="nuevo.precioVenta">

      <label>Precio de descuento</label>
      <input type="number" [(ngModel)]="nuevo.precioDescuento">

      <div class="modal-actions">
        <button class="btn cancel" (click)="cerrarModalAgregar()">Cancelar</button>
        <button class="btn save" (click)="guardarProducto()">Guardar</button>
      </div>
    </div>
  </div>

</div> <!-- FIN INVENTORY-PAGE -->
